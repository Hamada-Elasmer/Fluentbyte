<!--
    ==========================================================================
    SparkFlow File Header
    File: SparkFlowBot/SparkFlowBot.UI/Views/Pages/LogsPageView.axaml
    Purpose: UI markup for the SparkFlow application.
    Notes: Comments are kept in English for consistency.
    =========================================================================
-->
<UserControl
    x:Class="SparkFlow.UI.Views.Pages.LogsPageView"
    x:CompileBindings="True"
    x:DataType="vm:LogsPageViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:logger1="clr-namespace:SparkFlow.UI.Converters.Logger"
    xmlns:models="clr-namespace:UtiliLib.Models;assembly=UtiliLib"
    xmlns:vm="clr-namespace:SparkFlow.UI.ViewModels.Pages"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <UserControl.Resources>
        <logger1:UnixMsToLocalTimeStringConverter x:Key="UnixMsToLocalTimeString" />
        <logger1:LogLevelToBrushConverter x:Key="LogLevelToBrush" />

        <SolidColorBrush Color="#0B0B10" x:Key="Bg" />
        <SolidColorBrush Color="#11121A" x:Key="Panel" />
        <SolidColorBrush Color="#2B2F3A" x:Key="Border" />
        <SolidColorBrush Color="#A0A6B3" x:Key="Dim" />
        <SolidColorBrush Color="#E6E6E6" x:Key="Text" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="TextBlock.mono">
            <Setter Property="FontFamily" Value="Consolas" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextWrapping" Value="NoWrap" />
            <Setter Property="Foreground" Value="{StaticResource Text}" />
        </Style>

        <Style Selector="TextBlock.dim">
            <Setter Property="Foreground" Value="{StaticResource Dim}" />
        </Style>

        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        </Style>

        <Style Selector="ListBoxItem:selected">
            <Setter Property="Background" Value="#1B1D27" />
        </Style>
    </UserControl.Styles>

    <Grid
        ColumnDefinitions="*"
        Margin="16"
        RowDefinitions="Auto,Auto,*">

        <!--  Header  -->
        <Border
            CornerRadius="12"
            Grid.Row="0"
            Padding="0,0,0,10">
            <StackPanel Spacing="6">
                <TextBlock
                    FontSize="24"
                    FontWeight="Bold"
                    Text="Logs" />
                <TextBlock Opacity="0.65" Text="View, filter, copy, and export the latest log activity." />
            </StackPanel>
        </Border>

        <!--  Top bar: stats + filters + actions  -->
        <Border
            Background="{StaticResource Panel}"
            BorderBrush="{StaticResource Border}"
            BorderThickness="1"
            CornerRadius="10"
            Grid.Row="1"
            Margin="0,0,0,10"
            Padding="12">

            <StackPanel Spacing="10">

                <!--  Row 1: Stats + actions  -->
                <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto" ColumnSpacing="8">
                    <TextBlock
                        Classes="mono dim"
                        Text="{Binding StatsText}"
                        VerticalAlignment="Center" />

                    <Button
                        Command="{Binding RefreshLogsCommand}"
                        Content="Refresh"
                        Grid.Column="1" />
                    <Button
                        Command="{Binding ClearLogsCommand}"
                        Content="Clear"
                        Grid.Column="2" />
                    <Button
                        Command="{Binding ExportLogsCommand}"
                        Content="Export"
                        Grid.Column="3" />
                </Grid>

                <!--  Row 2: Filters  -->
                <Grid
                    ColumnDefinitions="Auto,180,Auto,180,Auto,240,Auto,160,Auto,160"
                    ColumnSpacing="8"
                    RowDefinitions="Auto"
                    VerticalAlignment="Center">

                    <!--  Level  -->
                    <TextBlock
                        Classes="mono dim"
                        Text="Level"
                        VerticalAlignment="Center" />
                    <ComboBox
                        Grid.Column="1"
                        HorizontalAlignment="Left"
                        ItemsSource="{Binding LevelOptions}"
                        MinWidth="160"
                        SelectedItem="{Binding SelectedLevel}" />

                    <!--  Channel  -->
                    <TextBlock
                        Classes="mono dim"
                        Grid.Column="2"
                        Text="Channel"
                        VerticalAlignment="Center" />
                    <ComboBox
                        Grid.Column="3"
                        HorizontalAlignment="Left"
                        ItemsSource="{Binding ChannelOptions}"
                        MinWidth="160"
                        SelectedItem="{Binding SelectedChannel}" />

                    <!--  Search Text  -->
                    <TextBlock
                        Classes="mono dim"
                        Grid.Column="4"
                        Text="Search"
                        VerticalAlignment="Center" />
                    <TextBox
                        Grid.Column="5"
                        MinWidth="220"
                        Text="{Binding SearchText}"
                        Watermark="Search in message..." />

                    <!--  RunId  -->
                    <TextBlock
                        Classes="mono dim"
                        Grid.Column="6"
                        Text="Run"
                        VerticalAlignment="Center" />
                    <TextBox
                        Grid.Column="7"
                        MinWidth="140"
                        Text="{Binding RunIdFilter}"
                        Watermark="RunId contains..." />

                    <!--  ProfileId  -->
                    <TextBlock
                        Classes="mono dim"
                        Grid.Column="8"
                        Text="Profile"
                        VerticalAlignment="Center" />
                    <TextBox
                        Grid.Column="9"
                        MinWidth="140"
                        Text="{Binding ProfileIdFilter}"
                        Watermark="ProfileId contains..." />

                </Grid>

                <!--  Row 3: Copy Selected  -->
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                    <TextBlock
                        Classes="mono dim"
                        Text="Tip: select a row then press Copy Selected."
                        VerticalAlignment="Center" />
                </Grid>

            </StackPanel>
        </Border>

        <!--  Console  -->
        <Border
            Background="{StaticResource Panel}"
            BorderBrush="{StaticResource Border}"
            BorderThickness="1"
            CornerRadius="10"
            Grid.Row="2"
            Padding="10">
            <ListBox ItemsSource="{Binding FilteredLogs}" x:Name="ConsoleList">

                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="models:LogEntry">

                        <Grid
                            ColumnDefinitions="Auto,Auto,Auto,Auto,*"
                            ColumnSpacing="10"
                            Margin="2,1">

                            <!--  [CHANNEL]  -->
                            <TextBlock Classes="mono" Text="{Binding Channel, StringFormat=[{0}]}" />

                            <!--  (TIME)  -->
                            <TextBlock
                                Classes="mono dim"
                                Grid.Column="1"
                                Text="{Binding Timestamp, Converter={StaticResource UnixMsToLocalTimeString}, StringFormat=({0})}" />

                            <!--  [LEVEL]  -->
                            <TextBlock
                                Classes="mono"
                                Foreground="{Binding Level, Converter={StaticResource LogLevelToBrush}}"
                                Grid.Column="2"
                                Text="{Binding Level, StringFormat=[{0}]}" />

                            <!--  Run/Profile (without MultiBinding)  -->
                            <StackPanel
                                Grid.Column="3"
                                Orientation="Horizontal"
                                Spacing="6">
                                <TextBlock Classes="mono dim" Text="Run:" />
                                <TextBlock Classes="mono dim" Text="{Binding RunId}" />
                                <TextBlock Classes="mono dim" Text="P:" />
                                <TextBlock Classes="mono dim" Text="{Binding ProfileId}" />
                            </StackPanel>

                            <!--  Message  -->
                            <TextBlock
                                Classes="mono"
                                Grid.Column="4"
                                Text="{Binding Text}"
                                TextTrimming="CharacterEllipsis">
                                <ToolTip.Tip>
                                    <TextBlock
                                        Classes="mono"
                                        Text="{Binding Text}"
                                        TextWrapping="Wrap"
                                        Width="800" />
                                </ToolTip.Tip>
                            </TextBlock>

                        </Grid>

                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>
    </Grid>
</UserControl>